<!doctype html>
<html lang="es-AR" class="h-full" x-data="AAPPApp()" x-init="init()">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AAPP Manager — Dashboard</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <script defer src="app.constants.js"></script>
  <script defer src="app.state.js"></script>
  <script defer src="app.utils.js"></script>
  <script defer src="app.core.js"></script>
  <script defer src="app.filters.js"></script>
  <script defer src="app.relations.js"></script>
  <script defer src="app.reports.js"></script>
  <script defer src="app.crud.js"></script>
  <script defer src="app.seeds.js"></script>
  <script defer src="app.js"></script>
  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          boxShadow: {
            soft: '0 10px 25px rgba(0,0,0,.25)',
          }
        }
      }
    }
  </script>

  <style>
    :root{
      --blue-acc: 56 189 248; /* sky-400 */
      --blue-acc2: 59 130 246; /* blue-500 */
    }
    .glass {
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(10px);
    }
    .ring-blue-soft { box-shadow: 0 0 0 1px rgba(56,189,248,.20), 0 10px 25px rgba(0,0,0,.25); }
    .scrollbar::-webkit-scrollbar{ height:10px; width:10px; }
    .scrollbar::-webkit-scrollbar-thumb{ background: rgba(56,189,248,.25); border-radius: 999px; }
    .scrollbar::-webkit-scrollbar-track{ background: rgba(255,255,255,.04); }
    .badge {
      border: 1px solid rgba(56,189,248,.35);
      background: rgba(56,189,248,.08);
      color: rgb(186 230 253);
    }
    .btn {
      border: 1px solid rgba(56,189,248,.30);
      background: rgba(56,189,248,.10);
    }
    .btn:hover { background: rgba(56,189,248,.16); }
    .btn-danger {
      border: 1px solid rgba(239,68,68,.35);
      background: rgba(239,68,68,.10);
    }
    .btn-danger:hover { background: rgba(239,68,68,.16); }
    .input {
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.10);
      outline: none;
    }
    .input:focus {
      border-color: rgba(56,189,248,.55);
      box-shadow: 0 0 0 3px rgba(56,189,248,.15);
    }
    .table th { position: sticky; top: 0; background: rgba(2,6,23,.95); }
  </style>
</head>

<body class="h-full bg-slate-950 text-slate-100">
  <div class="min-h-screen md:flex">
    <!-- Sidebar (desktop) -->
    <aside class="hidden md:flex md:flex-col w-64 border-r border-white/10 bg-slate-950/80 backdrop-blur sticky top-0 h-screen">
      <div class="px-4 py-6 flex items-center gap-3">
        <div class="w-10 h-10 rounded-2xl flex items-center justify-center glass ring-blue-soft">
          <i class="fa-solid fa-layer-group text-sky-300"></i>
        </div>
        <div>
          <h1 class="text-base font-extrabold tracking-tight">
            AAPP Manager
          </h1>
          <p class="text-xs text-slate-300">Dashboard local</p>
        </div>
      </div>

      <nav class="flex-1 px-4 space-y-2 overflow-y-auto scrollbar">
        <template x-for="t in tabs" :key="'side-' + t.key">
          <button
            class="w-full px-3 py-2 rounded-xl text-sm font-semibold flex items-center gap-3 border border-white/10"
            :class="activeTab === t.key ? 'bg-sky-500/15 border-sky-400/30 text-sky-200' : 'bg-white/5 hover:bg-white/8 text-slate-200'"
            @click="activeTab = t.key">
            <i class="fa-solid" :class="t.icon"></i>
            <span x-text="t.label"></span>
          </button>
        </template>
      </nav>

      <div class="p-4 text-xs text-slate-400">
        <div class="flex items-center justify-between">
          <span>Registros</span>
          <span class="badge px-2 py-1 rounded-lg" x-text="totalRecordsFiltered()"></span>
        </div>
      </div>
    </aside>

    <div class="flex-1 flex flex-col min-h-screen">
      <!-- Topbar -->
      <header class="sticky top-0 z-40 border-b border-white/10 bg-slate-950/80 backdrop-blur">
        <div class="w-full max-w-none px-4 py-4 flex flex-wrap items-center gap-3">
          <div class="w-10 h-10 rounded-2xl flex items-center justify-center glass ring-blue-soft md:hidden">
            <i class="fa-solid fa-layer-group text-sky-300"></i>
          </div>
          <div class="flex-1 md:hidden">
            <h1 class="text-lg md:text-xl font-extrabold tracking-tight">
              AAPP Manager <span class="text-sky-300">•</span> Dashboard
            </h1>
            <p class="text-xs md:text-sm text-slate-300">
              Todo local (localStorage) • CRUD • Relaciones • Resúmenes
            </p>
          </div>

          <div class="flex items-center gap-2 ml-auto">
            <button class="btn rounded-xl px-3 py-2 text-sm flex items-center gap-2" @click="toggleDark()">
              <i class="fa-solid" :class="isDark ? 'fa-moon text-sky-300' : 'fa-sun text-yellow-300'"></i>
              <span class="hidden sm:inline" x-text="isDark ? 'Dark' : 'Light'"></span>
            </button>

            <button class="btn rounded-xl px-3 py-2 text-sm flex items-center gap-2" @click="openModal('dataTools')">
              <i class="fa-solid fa-database text-sky-300"></i>
              <span class="hidden sm:inline">Datos</span>
            </button>

            <button class="btn rounded-xl px-3 py-2 text-sm flex items-center gap-2" @click="exportAllCSV()">
              <i class="fa-solid fa-file-csv text-sky-300"></i>
              <span class="hidden sm:inline">Exportar CSV</span>
            </button>
          </div>
        </div>
      </header>

      <!-- Main -->
      <main class="flex-1 w-full max-w-none px-4 py-6 pb-24 md:pb-6">

    <!-- Controls -->
    <section class="glass rounded-2xl p-3 ring-blue-soft">
      <div class="flex flex-wrap items-center gap-3">
        <div class="flex items-center gap-2">
          <span class="text-xs text-slate-300">Sección</span>
          <span class="badge text-xs px-2 py-1 rounded-lg" x-text="tabs.find(t => t.key === activeTab)?.label || ''"></span>
        </div>
        <div class="ml-auto flex items-center gap-2">
          <input class="input rounded-xl px-3 py-2 text-sm w-64 max-w-full"
                 placeholder="Buscar por nombre / URL / notas…"
                 x-model="q" />
          <span class="badge text-xs px-2 py-1 rounded-lg" x-text="'Registros: ' + totalRecordsFiltered()"></span>
        </div>
      </div>
    </section>

    <!-- Content -->
    <section class="mt-4">
      <!-- Dashboard -->
      <div x-show="activeTab==='dashboard'" x-transition.opacity>
        <div class="flex items-center gap-2 mb-3">
          <h2 class="text-lg font-extrabold">Dashboard</h2>
          <span class="badge text-xs px-2 py-1 rounded-lg">KPIs • Salud • Resumen</span>
        </div>

        <!-- Quick KPIs -->
        <section class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
          <div class="glass rounded-2xl p-4 ring-blue-soft">
            <div class="flex items-center justify-between">
              <div class="text-sm text-slate-300">Empresas</div>
              <i class="fa-solid fa-building text-sky-300"></i>
            </div>
            <div class="mt-2 text-2xl font-extrabold" x-text="db.saas.length"></div>
            <div class="mt-2 text-xs text-slate-400">SaaS registradas</div>
          </div>

          <div class="glass rounded-2xl p-4 ring-blue-soft">
            <div class="flex items-center justify-between">
              <div class="text-sm text-slate-300">Clientes</div>
              <i class="fa-solid fa-users text-sky-300"></i>
            </div>
            <div class="mt-2 text-2xl font-extrabold" x-text="db.clients.length"></div>
            <div class="mt-2 text-xs text-slate-400">Con planes + extras</div>
          </div>

          <div class="glass rounded-2xl p-4 ring-blue-soft">
            <div class="flex items-center justify-between">
              <div class="text-sm text-slate-300">Ingresos (estim.)</div>
              <i class="fa-solid fa-arrow-trend-up text-emerald-300"></i>
            </div>
            <div class="mt-2 text-2xl font-extrabold">
              <span x-text="fmtMoney(totalIncomeEstimate())"></span>
            </div>
            <div class="mt-2 text-xs text-slate-400">Planes + extras (por frecuencia)</div>
          </div>

          <div class="glass rounded-2xl p-4 ring-blue-soft">
            <div class="flex items-center justify-between">
              <div class="text-sm text-slate-300">Ads (total)</div>
              <i class="fa-solid fa-bullhorn text-sky-300"></i>
            </div>
            <div class="mt-2 text-2xl font-extrabold">
              <span x-text="fmtMoney(totalAdsSpendAllTime())"></span>
            </div>
            <div class="mt-2 text-xs text-slate-400">Gasto total con impuestos</div>
          </div>
        </section>

        <div class="grid grid-cols-1 xl:grid-cols-3 gap-4 mb-6">
          <div class="glass rounded-2xl p-4 ring-blue-soft xl:col-span-2">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-extrabold">Ingresos vs Ads</h3>
              <span class="badge text-xs px-2 py-1 rounded-lg">Mensual estimado</span>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-slate-200">
              <div class="bg-white/5 rounded-xl p-3 border border-white/10">
                <div class="text-xs text-slate-400">Ingresos estimados</div>
                <div class="mt-1 font-extrabold text-lg" x-text="fmtMoney(totalIncomeEstimate())"></div>
              </div>
              <div class="bg-white/5 rounded-xl p-3 border border-white/10">
                <div class="text-xs text-slate-400">Ads total</div>
                <div class="mt-1 font-extrabold text-lg" x-text="fmtMoney(totalAdsSpendAllTime())"></div>
              </div>
              <div class="bg-white/5 rounded-xl p-3 border border-white/10">
                <div class="text-xs text-slate-400">Egresos manuales</div>
                <div class="mt-1 font-extrabold text-lg" x-text="fmtMoney(totalExpensesManual())"></div>
              </div>
            </div>

            <div class="mt-4">
              <div class="flex items-center justify-between text-xs text-slate-400 mb-2">
                <span>Ads sobre ingresos</span>
                <span x-text="Math.min(100, Math.round((totalAdsSpendAllTime() / Math.max(totalIncomeEstimate(), 1)) * 100)) + '%'"></span>
              </div>
              <div class="h-2 rounded-full bg-white/5 overflow-hidden">
                <div class="h-full bg-sky-400" :style="'width:' + Math.min(100, Math.round((totalAdsSpendAllTime() / Math.max(totalIncomeEstimate(), 1)) * 100)) + '%'"></div>
              </div>
            </div>
          </div>

          <div class="glass rounded-2xl p-4 ring-blue-soft">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-extrabold">Balance estimado</h3>
              <i class="fa-solid fa-scale-balanced text-emerald-300"></i>
            </div>
            <div class="text-3xl font-extrabold" x-text="fmtMoney(balanceEstimate())"></div>
            <div class="mt-3 text-xs text-slate-400">Ingresos - egresos - ads</div>
            <div class="mt-4 space-y-2 text-sm text-slate-200">
              <div class="flex justify-between">
                <span>Planes</span>
                <span class="font-bold" x-text="fmtMoney(incomePlansMonthlyEstimate())"></span>
              </div>
              <div class="flex justify-between">
                <span>Extras</span>
                <span class="font-bold" x-text="fmtMoney(incomeExtrasMonthlyEstimate())"></span>
              </div>
              <div class="flex justify-between">
                <span>Ads (total)</span>
                <span class="font-bold" x-text="fmtMoney(totalAdsSpendAllTime())"></span>
              </div>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 xl:grid-cols-2 gap-4 mb-6">
          <div class="glass rounded-2xl p-4 ring-blue-soft">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-extrabold">Ingresos por tipo</h3>
              <span class="badge text-xs px-2 py-1 rounded-lg">Estimado mensual</span>
            </div>
            <div class="space-y-4">
              <div>
                <div class="flex items-center justify-between text-xs text-slate-300 mb-2">
                  <span>Planes</span>
                  <span x-text="fmtMoney(incomePlansMonthlyEstimate())"></span>
                </div>
                <div class="h-2 bg-white/5 rounded-full overflow-hidden">
                  <div class="h-full bg-emerald-400" :style="'width:' + Math.min(100, Math.round((incomePlansMonthlyEstimate() / Math.max(totalIncomeEstimate(), 1)) * 100)) + '%'"></div>
                </div>
              </div>
              <div>
                <div class="flex items-center justify-between text-xs text-slate-300 mb-2">
                  <span>Extras</span>
                  <span x-text="fmtMoney(incomeExtrasMonthlyEstimate())"></span>
                </div>
                <div class="h-2 bg-white/5 rounded-full overflow-hidden">
                  <div class="h-full bg-sky-400" :style="'width:' + Math.min(100, Math.round((incomeExtrasMonthlyEstimate() / Math.max(totalIncomeEstimate(), 1)) * 100)) + '%'"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="glass rounded-2xl p-4 ring-blue-soft">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-extrabold">Clientes por empresa</h3>
              <span class="badge text-xs px-2 py-1 rounded-lg">Cobertura</span>
            </div>
            <div class="space-y-3" x-show="db.saas.length">
              <template x-for="s in db.saas" :key="'dash-clients-'+s.id">
                <div>
                  <div class="flex items-center justify-between text-xs text-slate-300 mb-2">
                    <span x-text="s.name"></span>
                    <span x-text="countClientsBySaas(s.id)"></span>
                  </div>
                  <div class="h-2 bg-white/5 rounded-full overflow-hidden">
                    <div class="h-full bg-indigo-400" :style="'width:' + Math.min(100, Math.round((countClientsBySaas(s.id) / maxClientsBySaas()) * 100)) + '%'"></div>
                  </div>
                </div>
              </template>
            </div>
            <div class="text-sm text-slate-400" x-show="db.saas.length===0">
              Cargá empresas para ver su distribución de clientes.
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 xl:grid-cols-2 gap-4">
          <div class="glass rounded-2xl overflow-hidden">
            <div class="p-4 border-b border-white/10 flex items-center justify-between">
              <h3 class="font-extrabold">Empresas principales</h3>
              <span class="badge text-xs px-2 py-1 rounded-lg">Ingresos + Ads</span>
            </div>
            <div class="overflow-auto scrollbar">
              <table class="min-w-full table">
                <thead>
                  <tr class="text-left text-xs text-slate-300 border-b border-white/10">
                    <th class="p-3">Empresa</th>
                    <th class="p-3">Clientes</th>
                    <th class="p-3">Planes</th>
                    <th class="p-3">Ingresos (est.)</th>
                    <th class="p-3">Ads (total)</th>
                  </tr>
                </thead>
                <tbody class="text-sm">
                  <template x-for="s in db.saas" :key="'dash-saas-'+s.id">
                    <tr class="border-b border-white/5 hover:bg-white/5">
                      <td class="p-3 font-semibold" x-text="s.name"></td>
                      <td class="p-3" x-text="countClientsBySaas(s.id)"></td>
                      <td class="p-3" x-text="countPlansBySaas(s.id)"></td>
                      <td class="p-3 font-bold" x-text="fmtMoney(incomeEstimateBySaas(s.id))"></td>
                      <td class="p-3" x-text="fmtMoney(totalAdsSpendBySaas(s.id))"></td>
                    </tr>
                  </template>
                  <tr x-show="db.saas.length===0">
                    <td class="p-6 text-slate-400" colspan="5">
                      Sin empresas cargadas todavía.
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="glass rounded-2xl overflow-hidden">
            <div class="p-4 border-b border-white/10 flex items-center justify-between">
              <h3 class="font-extrabold">Campañas recientes</h3>
              <span class="badge text-xs px-2 py-1 rounded-lg">Últimas 5</span>
            </div>
            <div class="overflow-auto scrollbar">
              <table class="min-w-full table">
                <thead>
                  <tr class="text-left text-xs text-slate-300 border-b border-white/10">
                    <th class="p-3">Campaña</th>
                    <th class="p-3">Empresa</th>
                    <th class="p-3">Fecha</th>
                    <th class="p-3">Total</th>
                  </tr>
                </thead>
                <tbody class="text-sm">
                  <template x-for="c in db.campaigns.slice().reverse().slice(0, 5)" :key="'dash-camp-'+c.id">
                    <tr class="border-b border-white/5 hover:bg-white/5">
                      <td class="p-3 font-semibold" x-text="c.adName"></td>
                      <td class="p-3 text-sky-200 font-semibold" x-text="saasName(c.saasId)"></td>
                      <td class="p-3 text-slate-300" x-text="c.date"></td>
                      <td class="p-3 font-bold" x-text="fmtMoney(calcTotalWithTaxes(c))"></td>
                    </tr>
                  </template>
                  <tr x-show="db.campaigns.length===0">
                    <td class="p-6 text-slate-400" colspan="4">
                      Sin campañas registradas todavía.
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- SaaS -->
      <div x-show="activeTab==='saas'" x-transition.opacity>
        <div class="flex items-center gap-2 mb-3">
          <h2 class="text-lg font-extrabold">Empresas SaaS</h2>
          <span class="badge text-xs px-2 py-1 rounded-lg">Nombre • URL • Registro • Login • Relación</span>
          <div class="ml-auto">
            <button class="btn rounded-xl px-3 py-2 text-sm" @click="openModal('saasForm')">
              <i class="fa-solid fa-plus mr-2 text-sky-300"></i>Agregar
            </button>
          </div>
        </div>

        <div class="glass rounded-2xl overflow-hidden">
          <div class="overflow-auto scrollbar">
            <table class="min-w-full table">
              <thead>
                <tr class="text-left text-xs text-slate-300 border-b border-white/10">
                  <th class="p-3">Nombre</th>
                  <th class="p-3">URL</th>
                  <th class="p-3">Registro</th>
                  <th class="p-3">Login</th>
                  <th class="p-3">Clientes</th>
                  <th class="p-3">Planes</th>
                  <th class="p-3 w-40">Acciones</th>
                </tr>
              </thead>
              <tbody class="text-sm">
                <template x-for="s in filteredSaaS()" :key="s.id">
                  <tr class="border-b border-white/5 hover:bg-white/5">
                    <td class="p-3 font-semibold" x-text="s.name"></td>
                    <td class="p-3">
                      <a class="text-sky-300 hover:underline" :href="s.url" target="_blank" x-text="shortUrl(s.url)"></a>
                    </td>
                    <td class="p-3">
                      <a class="text-sky-300 hover:underline" :href="s.registerUrl" target="_blank" x-text="s.registerUrl ? 'Abrir' : '-'"></a>
                    </td>
                    <td class="p-3">
                      <a class="text-sky-300 hover:underline" :href="s.loginUrl" target="_blank" x-text="s.loginUrl ? 'Abrir' : '-'"></a>
                    </td>
                    <td class="p-3">
                      <span class="badge px-2 py-1 rounded-lg text-xs" x-text="countClientsBySaas(s.id)"></span>
                    </td>
                    <td class="p-3">
                      <span class="badge px-2 py-1 rounded-lg text-xs" x-text="countPlansBySaas(s.id)"></span>
                    </td>
                    <td class="p-3">
                      <div class="flex gap-2">
                        <button class="btn rounded-xl px-3 py-2 text-xs" @click="editSaas(s.id)">
                          <i class="fa-solid fa-pen-to-square text-sky-300 mr-1"></i>Editar
                        </button>
                        <button class="btn-danger rounded-xl px-3 py-2 text-xs" @click="delSaas(s.id)">
                          <i class="fa-solid fa-trash text-red-300 mr-1"></i>Borrar
                        </button>
                      </div>
                    </td>
                  </tr>
                </template>

                <tr x-show="filteredSaaS().length===0">
                  <td class="p-6 text-slate-400" colspan="7">
                    No hay registros. Agregá tus SaaS (ej: aapp.space, minitienda.uno).
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Plans -->
      <div x-show="activeTab==='plans'" x-transition.opacity>
        <div class="flex items-center gap-2 mb-3">
          <h2 class="text-lg font-extrabold">Planes</h2>
          <span class="badge text-xs px-2 py-1 rounded-lg">Mensual • Anual • Empresa</span>
          <div class="ml-auto">
            <button class="btn rounded-xl px-3 py-2 text-sm" @click="openModal('planForm')">
              <i class="fa-solid fa-plus mr-2 text-sky-300"></i>Agregar
            </button>
          </div>
        </div>

        <div class="glass rounded-2xl overflow-hidden">
          <div class="overflow-auto scrollbar">
            <table class="min-w-full table">
              <thead>
                <tr class="text-left text-xs text-slate-300 border-b border-white/10">
                  <th class="p-3">Título</th>
                  <th class="p-3">Frecuencia</th>
                  <th class="p-3">Precio</th>
                  <th class="p-3">Empresa</th>
                  <th class="p-3">Descripción</th>
                  <th class="p-3 w-40">Acciones</th>
                </tr>
              </thead>
              <tbody class="text-sm">
                <template x-for="p in filteredPlans()" :key="p.id">
                  <tr class="border-b border-white/5 hover:bg-white/5">
                    <td class="p-3 font-semibold" x-text="p.title"></td>
                    <td class="p-3">
                      <span class="badge px-2 py-1 rounded-lg text-xs" x-text="p.frequency"></span>
                    </td>
                    <td class="p-3 font-bold" x-text="fmtMoney(p.price)"></td>
                    <td class="p-3">
                      <span class="text-sky-200 font-semibold" x-text="saasName(p.saasId)"></span>
                    </td>
                    <td class="p-3 text-slate-300" x-text="p.description || '-'"></td>
                    <td class="p-3">
                      <div class="flex gap-2">
                        <button class="btn rounded-xl px-3 py-2 text-xs" @click="editPlan(p.id)">
                          <i class="fa-solid fa-pen-to-square text-sky-300 mr-1"></i>Editar
                        </button>
                        <button class="btn-danger rounded-xl px-3 py-2 text-xs" @click="delPlan(p.id)">
                          <i class="fa-solid fa-trash text-red-300 mr-1"></i>Borrar
                        </button>
                      </div>
                    </td>
                  </tr>
                </template>

                <tr x-show="filteredPlans().length===0">
                  <td class="p-6 text-slate-400" colspan="6">
                    No hay planes todavía. Creá planes mensuales/anuales por empresa.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Campaigns -->
      <div x-show="activeTab==='campaigns'" x-transition.opacity>
        <div class="flex items-center gap-2 mb-3">
          <h2 class="text-lg font-extrabold">Campañas Publicitarias</h2>
          <span class="badge text-xs px-2 py-1 rounded-lg">Impuestos auto • Resúmenes</span>
          <div class="ml-auto flex items-center gap-2">
            <button class="btn rounded-xl px-3 py-2 text-sm" @click="openModal('campaignForm')">
              <i class="fa-solid fa-plus mr-2 text-sky-300"></i>Agregar
            </button>
          </div>
        </div>

        <!-- Summary cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
          <div class="glass rounded-2xl p-4 ring-blue-soft">
            <div class="flex items-center justify-between">
              <div class="text-sm text-slate-300">Hoy (estim.)</div>
              <i class="fa-solid fa-calendar-day text-sky-300"></i>
            </div>
            <div class="mt-2 text-2xl font-extrabold" x-text="fmtMoney(adsSpendToday())"></div>
            <div class="mt-2 text-xs text-slate-400">Suma de (gasto_día + impuestos) por campaña</div>
          </div>

          <div class="glass rounded-2xl p-4 ring-blue-soft">
            <div class="flex items-center justify-between">
              <div class="text-sm text-slate-300">Semana (7 días)</div>
              <i class="fa-solid fa-calendar-week text-sky-300"></i>
            </div>
            <div class="mt-2 text-2xl font-extrabold" x-text="fmtMoney(adsSpendWeek())"></div>
            <div class="mt-2 text-xs text-slate-400">Hoy * 7 (estimación rápida)</div>
          </div>

          <div class="glass rounded-2xl p-4 ring-blue-soft">
            <div class="flex items-center justify-between">
              <div class="text-sm text-slate-300">Total (configurado)</div>
              <i class="fa-solid fa-sack-dollar text-sky-300"></i>
            </div>
            <div class="mt-2 text-2xl font-extrabold" x-text="fmtMoney(totalAdsSpendAllTime())"></div>
            <div class="mt-2 text-xs text-slate-400">Suma de gasto_total (con impuestos)</div>
          </div>
        </div>

        <div class="glass rounded-2xl overflow-hidden">
          <div class="overflow-auto scrollbar">
            <table class="min-w-full table">
              <thead>
                <tr class="text-left text-xs text-slate-300 border-b border-white/10">
                  <th class="p-3">Anuncio / Nombre</th>
                  <th class="p-3">Empresa</th>
                  <th class="p-3">Fecha</th>
                  <th class="p-3">Gasto por día</th>
                  <th class="p-3">Impuestos</th>
                  <th class="p-3">Gasto total</th>
                  <th class="p-3 w-40">Acciones</th>
                </tr>
              </thead>
              <tbody class="text-sm">
                <template x-for="c in filteredCampaigns()" :key="c.id">
                  <tr class="border-b border-white/5 hover:bg-white/5">
                    <td class="p-3 font-semibold" x-text="c.adName"></td>
                    <td class="p-3 text-sky-200 font-semibold" x-text="saasName(c.saasId)"></td>
                    <td class="p-3 text-slate-300" x-text="c.date"></td>
                    <td class="p-3 font-bold" x-text="fmtMoney(c.dailySpend)"></td>
                    <td class="p-3" x-text="fmtMoney(calcTaxes(c))"></td>
                    <td class="p-3 font-extrabold" x-text="fmtMoney(calcTotalWithTaxes(c))"></td>
                    <td class="p-3">
                      <div class="flex gap-2">
                        <button class="btn rounded-xl px-3 py-2 text-xs" @click="editCampaign(c.id)">
                          <i class="fa-solid fa-pen-to-square text-sky-300 mr-1"></i>Editar
                        </button>
                        <button class="btn-danger rounded-xl px-3 py-2 text-xs" @click="delCampaign(c.id)">
                          <i class="fa-solid fa-trash text-red-300 mr-1"></i>Borrar
                        </button>
                      </div>
                    </td>
                  </tr>
                </template>

                <tr x-show="filteredCampaigns().length===0">
                  <td class="p-6 text-slate-400" colspan="7">
                    Sin campañas. Registrá anuncios con gasto por día y total.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="mt-4 glass rounded-2xl p-4">
          <h3 class="font-extrabold mb-2">Reporte rápido (por empresa)</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <template x-for="s in db.saas" :key="'rep-'+s.id">
              <div class="border border-white/10 rounded-2xl p-4 bg-white/5">
                <div class="flex items-center justify-between">
                  <div class="font-extrabold text-sky-200" x-text="s.name"></div>
                  <span class="badge text-xs px-2 py-1 rounded-lg" x-text="'Campañas: ' + campaignsBySaas(s.id).length"></span>
                </div>
                <div class="mt-2 text-sm text-slate-300">
                  <div class="flex justify-between">
                    <span>Gasto total</span>
                    <span class="font-bold" x-text="fmtMoney(totalAdsSpendBySaas(s.id))"></span>
                  </div>
                  <div class="flex justify-between">
                    <span>Gasto diario (sum)</span>
                    <span class="font-bold" x-text="fmtMoney(sumDailySpendBySaas(s.id))"></span>
                  </div>
                </div>
              </div>
            </template>
          </div>
        </div>
      </div>

      <!-- Clients -->
      <div x-show="activeTab==='clients'" x-transition.opacity>
        <div class="flex items-center gap-2 mb-3">
          <h2 class="text-lg font-extrabold">Clientes</h2>
          <span class="badge text-xs px-2 py-1 rounded-lg">Plan activo • Extras • Total • Credenciales</span>
          <div class="ml-auto">
            <button class="btn rounded-xl px-3 py-2 text-sm" @click="openModal('clientForm')">
              <i class="fa-solid fa-plus mr-2 text-sky-300"></i>Agregar
            </button>
          </div>
        </div>

        <div class="glass rounded-2xl overflow-hidden">
          <div class="overflow-auto scrollbar">
            <table class="min-w-full table">
              <thead>
                <tr class="text-left text-xs text-slate-300 border-b border-white/10">
                  <th class="p-3">Nombre</th>
                  <th class="p-3">Empresa</th>
                  <th class="p-3">Plan activo</th>
                  <th class="p-3">Extras</th>
                  <th class="p-3">Total</th>
                  <th class="p-3">Fecha</th>
                  <th class="p-3">Notas</th>
                  <th class="p-3 w-40">Acciones</th>
                </tr>
              </thead>
              <tbody class="text-sm">
                <template x-for="cl in filteredClients()" :key="cl.id">
                  <tr class="border-b border-white/5 hover:bg-white/5 align-top">
                    <td class="p-3 font-semibold">
                      <div x-text="cl.name"></div>
                      <div class="text-xs text-slate-400 mt-1">
                        <div><i class="fa-regular fa-envelope mr-1"></i><span x-text="cl.email || '-'"></span></div>
                        <div><i class="fa-solid fa-key mr-1"></i><span x-text="cl.password || '-'"></span></div>
                      </div>
                      <div class="text-xs mt-2" x-show="(cl.links||'').trim().length">
                        <i class="fa-solid fa-link text-sky-300 mr-1"></i>
                        <span class="text-slate-300" x-text="cl.links"></span>
                      </div>
                    </td>

                    <td class="p-3 text-sky-200 font-semibold" x-text="saasName(cl.saasId)"></td>

                    <td class="p-3">
                      <div class="font-bold" x-text="planTitle(cl.planId)"></div>
                      <div class="text-xs text-slate-400" x-text="planFrequency(cl.planId)"></div>
                      <div class="text-xs text-slate-400" x-text="fmtMoney(planPrice(cl.planId))"></div>
                    </td>

                    <td class="p-3">
                      <template x-if="(cl.extraIds||[]).length">
                        <div class="flex flex-wrap gap-2">
                          <template x-for="eid in cl.extraIds" :key="eid">
                            <span class="badge px-2 py-1 rounded-lg text-xs" x-text="extraName(eid)"></span>
                          </template>
                        </div>
                      </template>
                      <div x-show="!(cl.extraIds||[]).length" class="text-slate-400">-</div>
                    </td>

                    <td class="p-3 font-extrabold" x-text="fmtMoney(clientTotal(cl))"></td>

                    <td class="p-3 text-slate-300" x-text="cl.date || '-'"></td>
                    <td class="p-3 text-slate-300" x-text="cl.notes || '-'"></td>

                    <td class="p-3">
                      <div class="flex gap-2">
                        <button class="btn rounded-xl px-3 py-2 text-xs" @click="editClient(cl.id)">
                          <i class="fa-solid fa-pen-to-square text-sky-300 mr-1"></i>Editar
                        </button>
                        <button class="btn-danger rounded-xl px-3 py-2 text-xs" @click="delClient(cl.id)">
                          <i class="fa-solid fa-trash text-red-300 mr-1"></i>Borrar
                        </button>
                      </div>
                    </td>
                  </tr>
                </template>

                <tr x-show="filteredClients().length===0">
                  <td class="p-6 text-slate-400" colspan="8">
                    Sin clientes. Agregá clientes con plan activo y extras.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Extras -->
      <div x-show="activeTab==='extras'" x-transition.opacity>
        <div class="flex items-center gap-2 mb-3">
          <h2 class="text-lg font-extrabold">Servicios Extras</h2>
          <span class="badge text-xs px-2 py-1 rounded-lg">Mensual • Anual • Única vez</span>
          <div class="ml-auto">
            <button class="btn rounded-xl px-3 py-2 text-sm" @click="openModal('extraForm')">
              <i class="fa-solid fa-plus mr-2 text-sky-300"></i>Agregar
            </button>
          </div>
        </div>

        <div class="glass rounded-2xl overflow-hidden">
          <div class="overflow-auto scrollbar">
            <table class="min-w-full table">
              <thead>
                <tr class="text-left text-xs text-slate-300 border-b border-white/10">
                  <th class="p-3">Nombre</th>
                  <th class="p-3">Frecuencia</th>
                  <th class="p-3">Precio</th>
                  <th class="p-3 w-40">Acciones</th>
                </tr>
              </thead>
              <tbody class="text-sm">
                <template x-for="e in filteredExtras()" :key="e.id">
                  <tr class="border-b border-white/5 hover:bg-white/5">
                    <td class="p-3 font-semibold" x-text="e.name"></td>
                    <td class="p-3"><span class="badge text-xs px-2 py-1 rounded-lg" x-text="e.frequency"></span></td>
                    <td class="p-3 font-bold" x-text="fmtMoney(e.price)"></td>
                    <td class="p-3">
                      <div class="flex gap-2">
                        <button class="btn rounded-xl px-3 py-2 text-xs" @click="editExtra(e.id)">
                          <i class="fa-solid fa-pen-to-square text-sky-300 mr-1"></i>Editar
                        </button>
                        <button class="btn-danger rounded-xl px-3 py-2 text-xs" @click="delExtra(e.id)">
                          <i class="fa-solid fa-trash text-red-300 mr-1"></i>Borrar
                        </button>
                      </div>
                    </td>
                  </tr>
                </template>

                <tr x-show="filteredExtras().length===0">
                  <td class="p-6 text-slate-400" colspan="4">
                    Sin extras todavía. Ej: Dominio .com, Logo, Setup, Ads, etc.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Balance -->
      <div x-show="activeTab==='balance'" x-transition.opacity>
        <div class="flex items-center gap-2 mb-3">
          <h2 class="text-lg font-extrabold">Balance</h2>
          <span class="badge text-xs px-2 py-1 rounded-lg">Ingresos • Egresos • Ventas • Dominios • Extras</span>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="glass rounded-2xl p-4 ring-blue-soft">
            <h3 class="font-extrabold mb-3">Resumen (estimado desde Clientes)</h3>

            <div class="space-y-2 text-sm text-slate-200">
              <div class="flex justify-between">
                <span>Ventas (cantidad clientes)</span>
                <span class="font-bold" x-text="db.clients.length"></span>
              </div>
              <div class="flex justify-between">
                <span>Ingresos (planes + extras normalizado/mes)</span>
                <span class="font-extrabold" x-text="fmtMoney(totalIncomeEstimate())"></span>
              </div>
              <div class="flex justify-between">
                <span>Ads (gasto diario total)</span>
                <span class="font-bold" x-text="fmtMoney(sumDailySpendAll())"></span>
              </div>
              <div class="flex justify-between">
                <span>Ads (gasto total con impuestos)</span>
                <span class="font-extrabold" x-text="fmtMoney(totalAdsSpendAllTime())"></span>
              </div>
            </div>

            <div class="mt-4 border-t border-white/10 pt-4">
              <h4 class="font-bold mb-2">Desglose (por tipo)</h4>
              <div class="space-y-2 text-sm text-slate-200">
                <div class="flex justify-between">
                  <span>Planes (estimado/mes)</span>
                  <span class="font-bold" x-text="fmtMoney(incomePlansMonthlyEstimate())"></span>
                </div>
                <div class="flex justify-between">
                  <span>Servicios extras (estimado/mes)</span>
                  <span class="font-bold" x-text="fmtMoney(incomeExtrasMonthlyEstimate())"></span>
                </div>
                <div class="flex justify-between">
                  <span>Dominios contratados (conteo)</span>
                  <span class="font-bold" x-text="domainExtrasCount()"></span>
                </div>
              </div>
            </div>

          </div>

          <div class="glass rounded-2xl p-4 ring-blue-soft">
            <h3 class="font-extrabold mb-3">Egresos manuales (opcional)</h3>
            <p class="text-sm text-slate-300 mb-4">
              Si querés llevar egresos que no salen de campañas (sueldos, hosting, etc.), registralos acá.
            </p>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
              <input class="input rounded-xl px-3 py-2 text-sm" placeholder="Concepto" x-model="expenseForm.name" />
              <input class="input rounded-xl px-3 py-2 text-sm" placeholder="Monto (ARS)" type="number" x-model.number="expenseForm.amount" />
              <input class="input rounded-xl px-3 py-2 text-sm" placeholder="Fecha (YYYY-MM-DD)" x-model="expenseForm.date" />
            </div>

            <div class="mt-3 flex gap-2">
              <button class="btn rounded-xl px-3 py-2 text-sm" @click="addExpense()">
                <i class="fa-solid fa-plus text-sky-300 mr-2"></i>Agregar egreso
              </button>
              <button class="btn-danger rounded-xl px-3 py-2 text-sm" @click="clearExpenses()">
                <i class="fa-solid fa-trash text-red-300 mr-2"></i>Limpiar
              </button>
            </div>

            <div class="mt-4">
              <div class="flex items-center justify-between mb-2">
                <div class="font-bold">Lista de egresos</div>
                <div class="badge text-xs px-2 py-1 rounded-lg" x-text="'Total: ' + fmtMoney(totalExpensesManual())"></div>
              </div>

              <div class="max-h-64 overflow-auto scrollbar rounded-2xl border border-white/10">
                <template x-for="(ex, idx) in db.expenses" :key="'ex-'+idx">
                  <div class="flex items-center justify-between px-3 py-2 border-b border-white/5 bg-white/5">
                    <div class="text-sm">
                      <div class="font-semibold" x-text="ex.name"></div>
                      <div class="text-xs text-slate-400" x-text="ex.date || '-'"></div>
                    </div>
                    <div class="flex items-center gap-3">
                      <div class="font-extrabold" x-text="fmtMoney(ex.amount)"></div>
                      <button class="btn-danger rounded-xl px-3 py-2 text-xs" @click="removeExpense(idx)">
                        <i class="fa-solid fa-xmark"></i>
                      </button>
                    </div>
                  </div>
                </template>
                <div class="p-4 text-slate-400 text-sm" x-show="db.expenses.length===0">
                  No hay egresos cargados.
                </div>
              </div>

              <div class="mt-4 border-t border-white/10 pt-4 text-sm">
                <div class="flex justify-between">
                  <span>Ingresos (estim.)</span>
                  <span class="font-bold" x-text="fmtMoney(totalIncomeEstimate())"></span>
                </div>
                <div class="flex justify-between">
                  <span>Egresos manuales</span>
                  <span class="font-bold" x-text="fmtMoney(totalExpensesManual())"></span>
                </div>
                <div class="flex justify-between">
                  <span>Ads total</span>
                  <span class="font-bold" x-text="fmtMoney(totalAdsSpendAllTime())"></span>
                </div>
                <div class="flex justify-between mt-2">
                  <span class="font-extrabold text-sky-200">Saldo (estim.)</span>
                  <span class="font-extrabold text-sky-200" x-text="fmtMoney(balanceEstimate())"></span>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>

      <!-- Settings/Help -->
      <div x-show="activeTab==='help'" x-transition.opacity>
        <div class="glass rounded-2xl p-5 ring-blue-soft">
          <h2 class="text-lg font-extrabold mb-2">Ayuda rápida</h2>
          <ul class="list-disc pl-6 text-sm text-slate-300 space-y-2">
            <li>Todo se guarda en tu navegador (localStorage). Si borrás datos del navegador, se pierde.</li>
            <li>Relaciones:
              <span class="text-sky-200 font-semibold">Planes</span> pertenecen a una <span class="text-sky-200 font-semibold">Empresa</span>;
              <span class="text-sky-200 font-semibold">Clientes</span> eligen un <span class="text-sky-200 font-semibold">Plan</span> y <span class="text-sky-200 font-semibold">Extras</span>.
            </li>
            <li>Campañas:
              <span class="text-sky-200 font-semibold">Gasto total = gasto por día + impuestos</span>.
              Acá calculamos: <span class="text-sky-200 font-semibold">Impuestos = (gasto total - gasto por día)</span>.
            </li>
            <li>En “Datos” podés exportar/importar JSON para backup o migración.</li>
          </ul>
        </div>
      </div>
    </section>
      </main>
    </div>
  </div>

  <!-- Mobile footer nav -->
  <footer class="md:hidden fixed bottom-0 left-0 right-0 z-50 border-t border-white/10 bg-slate-950/90 backdrop-blur">
    <div class="flex gap-2 px-3 py-2 overflow-x-auto scrollbar snap-x snap-mandatory">
      <template x-for="t in tabs" :key="'mobile-' + t.key">
        <button
          class="min-w-[84px] flex flex-col items-center gap-1 px-3 py-2 rounded-xl text-xs font-semibold border border-white/10 snap-start"
          :class="activeTab === t.key ? 'bg-sky-500/15 border-sky-400/30 text-sky-200' : 'bg-white/5 hover:bg-white/8 text-slate-200'"
          @click="activeTab = t.key">
          <i class="fa-solid text-base" :class="t.icon"></i>
          <span x-text="t.label"></span>
        </button>
      </template>
    </div>
  </footer>

  <!-- Modal overlay -->
  <div x-show="modal.open" x-transition.opacity class="fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/60" @click="closeModal()"></div>

    <div class="relative w-full max-w-2xl glass rounded-2xl shadow-soft border border-white/10">
      <div class="flex items-center justify-between p-4 border-b border-white/10">
        <div class="font-extrabold text-sky-200" x-text="modal.title"></div>
        <button class="btn-danger rounded-xl px-3 py-2 text-sm" @click="closeModal()">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>

      <div class="p-4 max-h-[75vh] overflow-auto scrollbar">
        <!-- SaaS Form -->
        <div x-show="modal.view==='saasForm'">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div>
              <label class="text-xs text-slate-300">Nombre</label>
              <input class="input rounded-xl px-3 py-2 w-full" x-model="forms.saas.name" placeholder="aapp.space / minitienda.uno" />
            </div>
            <div>
              <label class="text-xs text-slate-300">URL</label>
              <input class="input rounded-xl px-3 py-2 w-full" x-model="forms.saas.url" placeholder="https://aapp.space" />
            </div>
            <div>
              <label class="text-xs text-slate-300">Link de registro</label>
              <input class="input rounded-xl px-3 py-2 w-full" x-model="forms.saas.registerUrl" placeholder="https://..." />
            </div>
            <div>
              <label class="text-xs text-slate-300">Link de login</label>
              <input class="input rounded-xl px-3 py-2 w-full" x-model="forms.saas.loginUrl" placeholder="https://..." />
            </div>
          </div>

          <div class="mt-4 flex gap-2">
            <button class="btn rounded-xl px-3 py-2 text-sm" @click="saveSaas()">
              <i class="fa-solid fa-floppy-disk text-sky-300 mr-2"></i>Guardar
            </button>
            <button class="btn rounded-xl px-3 py-2 text-sm" @click="closeModal()">Cancelar</button>
          </div>
        </div>

        <!-- Plan Form -->
        <div x-show="modal.view==='planForm'">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div>
              <label class="text-xs text-slate-300">Empresa</label>
              <select class="input rounded-xl px-3 py-2 w-full" x-model="forms.plan.saasId">
                <option value="">Seleccionar</option>
                <template x-for="s in db.saas" :key="'ps-'+s.id">
                  <option :value="s.id" x-text="s.name"></option>
                </template>
              </select>
            </div>

            <div>
              <label class="text-xs text-slate-300">Frecuencia</label>
              <select class="input rounded-xl px-3 py-2 w-full" x-model="forms.plan.frequency">
                <option>Por mes</option>
                <option>Por año</option>
              </select>
            </div>

            <div>
              <label class="text-xs text-slate-300">Título</label>
              <input class="input rounded-xl px-3 py-2 w-full" x-model="forms.plan.title" placeholder="Básico / Premium" />
            </div>

            <div>
              <label class="text-xs text-slate-300">Precio (ARS)</label>
              <input class="input rounded-xl px-3 py-2 w-full" type="number" x-model.number="forms.plan.price" placeholder="100000" />
            </div>

            <div class="md:col-span-2">
              <label class="text-xs text-slate-300">Descripción</label>
              <textarea class="input rounded-xl px-3 py-2 w-full min-h-[90px]" x-model="forms.plan.description" placeholder="Qué incluye, límites, etc."></textarea>
            </div>
          </div>

          <div class="mt-4 flex gap-2">
            <button class="btn rounded-xl px-3 py-2 text-sm" @click="savePlan()">
              <i class="fa-solid fa-floppy-disk text-sky-300 mr-2"></i>Guardar
            </button>
            <button class="btn rounded-xl px-3 py-2 text-sm" @click="closeModal()">Cancelar</button>
          </div>
        </div>

        <!-- Campaign Form -->
        <div x-show="modal.view==='campaignForm'">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div>
              <label class="text-xs text-slate-300">Empresa</label>
              <select class="input rounded-xl px-3 py-2 w-full" x-model="forms.campaign.saasId">
                <option value="">Seleccionar</option>
                <template x-for="s in db.saas" :key="'cs-'+s.id">
                  <option :value="s.id" x-text="s.name"></option>
                </template>
              </select>
            </div>

            <div>
              <label class="text-xs text-slate-300">Fecha</label>
              <input class="input rounded-xl px-3 py-2 w-full" x-model="forms.campaign.date" placeholder="YYYY-MM-DD" />
            </div>

            <div class="md:col-span-2">
              <label class="text-xs text-slate-300">Anuncio / Nombre</label>
              <input class="input rounded-xl px-3 py-2 w-full" x-model="forms.campaign.adName" placeholder="Lead Ads / Campaña Navidad / etc" />
            </div>

            <div>
              <label class="text-xs text-slate-300">Gasto por día (ARS)</label>
              <input class="input rounded-xl px-3 py-2 w-full" type="number" x-model.number="forms.campaign.dailySpend" />
            </div>

            <div>
              <label class="text-xs text-slate-300">Gasto total (ARS)</label>
              <input class="input rounded-xl px-3 py-2 w-full" type="number" x-model.number="forms.campaign.totalSpend" />
              <div class="text-xs text-slate-400 mt-1">
                Impuestos = (total - diario) ⇒ <span class="text-sky-200 font-bold" x-text="fmtMoney(calcTaxes(forms.campaign))"></span>
              </div>
            </div>
          </div>

          <div class="mt-4 flex gap-2">
            <button class="btn rounded-xl px-3 py-2 text-sm" @click="saveCampaign()">
              <i class="fa-solid fa-floppy-disk text-sky-300 mr-2"></i>Guardar
            </button>
            <button class="btn rounded-xl px-3 py-2 text-sm" @click="closeModal()">Cancelar</button>
          </div>
        </div>

        <!-- Extra Form -->
        <div x-show="modal.view==='extraForm'">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div>
              <label class="text-xs text-slate-300">Nombre</label>
              <input class="input rounded-xl px-3 py-2 w-full" x-model="forms.extra.name" placeholder="Logo, Dominio, Setup, Ads, etc" />
            </div>

            <div>
              <label class="text-xs text-slate-300">Frecuencia</label>
              <select class="input rounded-xl px-3 py-2 w-full" x-model="forms.extra.frequency">
                <option>Por mes</option>
                <option>Por año</option>
                <option>Única vez</option>
              </select>
            </div>

            <div class="md:col-span-2">
              <label class="text-xs text-slate-300">Precio (ARS)</label>
              <input class="input rounded-xl px-3 py-2 w-full" type="number" x-model.number="forms.extra.price" />
            </div>
          </div>

          <div class="mt-4 flex gap-2">
            <button class="btn rounded-xl px-3 py-2 text-sm" @click="saveExtra()">
              <i class="fa-solid fa-floppy-disk text-sky-300 mr-2"></i>Guardar
            </button>
            <button class="btn rounded-xl px-3 py-2 text-sm" @click="closeModal()">Cancelar</button>
          </div>
        </div>

        <!-- Client Form -->
        <div x-show="modal.view==='clientForm'">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div>
              <label class="text-xs text-slate-300">Nombre</label>
              <input class="input rounded-xl px-3 py-2 w-full" x-model="forms.client.name" placeholder="Nombre del cliente" />
            </div>

            <div>
              <label class="text-xs text-slate-300">Fecha</label>
              <input class="input rounded-xl px-3 py-2 w-full" x-model="forms.client.date" placeholder="YYYY-MM-DD" />
            </div>

            <div>
              <label class="text-xs text-slate-300">Empresa</label>
              <select class="input rounded-xl px-3 py-2 w-full" x-model="forms.client.saasId" @change="syncPlanToCompany()">
                <option value="">Seleccionar</option>
                <template x-for="s in db.saas" :key="'cl-s-'+s.id">
                  <option :value="s.id" x-text="s.name"></option>
                </template>
              </select>
            </div>

            <div>
              <label class="text-xs text-slate-300">Plan activo</label>
              <select class="input rounded-xl px-3 py-2 w-full" x-model="forms.client.planId">
                <option value="">Seleccionar</option>
                <template x-for="p in plansBySaas(forms.client.saasId)" :key="'cl-p-'+p.id">
                  <option :value="p.id" x-text="p.title + ' • ' + p.frequency + ' • ' + fmtMoney(p.price)"></option>
                </template>
              </select>
            </div>

            <div class="md:col-span-2">
              <label class="text-xs text-slate-300">Servicios extras</label>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-1">
                <template x-for="e in db.extras" :key="'ce-'+e.id">
                  <label class="flex items-center gap-2 bg-white/5 border border-white/10 rounded-xl px-3 py-2 text-sm">
                    <input type="checkbox" class="accent-sky-400"
                           :value="e.id"
                           @change="toggleClientExtra(e.id, $event.target.checked)"
                           :checked="(forms.client.extraIds||[]).includes(e.id)"/>
                    <span class="flex-1">
                      <span class="font-semibold" x-text="e.name"></span>
                      <span class="text-xs text-slate-400 ml-2" x-text="e.frequency + ' • ' + fmtMoney(e.price)"></span>
                    </span>
                  </label>
                </template>
                <div class="text-slate-400 text-sm" x-show="db.extras.length===0">
                  No hay extras creados todavía.
                </div>
              </div>
            </div>

            <div>
              <label class="text-xs text-slate-300">Correo</label>
              <input class="input rounded-xl px-3 py-2 w-full" x-model="forms.client.email" placeholder="correo@..." />
            </div>

            <div>
              <label class="text-xs text-slate-300">Contraseña</label>
              <input class="input rounded-xl px-3 py-2 w-full" x-model="forms.client.password" placeholder="(guardado local)" />
            </div>

            <div class="md:col-span-2">
              <label class="text-xs text-slate-300">Enlaces</label>
              <input class="input rounded-xl px-3 py-2 w-full" x-model="forms.client.links" placeholder="Links relevantes (panel, drive, etc)" />
            </div>

            <div class="md:col-span-2">
              <label class="text-xs text-slate-300">Notas</label>
              <textarea class="input rounded-xl px-3 py-2 w-full min-h-[90px]" x-model="forms.client.notes" placeholder="Notas de seguimiento, estado, etc"></textarea>
            </div>
          </div>

          <div class="mt-3 text-sm text-slate-300">
            Total cliente (estimado): <span class="text-sky-200 font-extrabold" x-text="fmtMoney(clientTotal(forms.client))"></span>
          </div>

          <div class="mt-4 flex gap-2">
            <button class="btn rounded-xl px-3 py-2 text-sm" @click="saveClient()">
              <i class="fa-solid fa-floppy-disk text-sky-300 mr-2"></i>Guardar
            </button>
            <button class="btn rounded-xl px-3 py-2 text-sm" @click="closeModal()">Cancelar</button>
          </div>
        </div>

        <!-- Data Tools -->
        <div x-show="modal.view==='dataTools'">
          <div class="space-y-3">
            <div class="glass rounded-2xl p-4 border border-white/10">
              <div class="flex items-center justify-between">
                <div>
                  <div class="font-extrabold">Exportar (backup)</div>
                  <div class="text-sm text-slate-300">Descargá un JSON con todo tu sistema.</div>
                </div>
                <button class="btn rounded-xl px-3 py-2 text-sm" @click="exportJSON()">
                  <i class="fa-solid fa-file-export text-sky-300 mr-2"></i>Exportar
                </button>
              </div>
            </div>

            <div class="glass rounded-2xl p-4 border border-white/10">
              <div class="font-extrabold">Importar (restaurar)</div>
              <div class="text-sm text-slate-300 mb-2">Pegá tu JSON y cargalo.</div>
              <textarea class="input rounded-2xl px-3 py-2 w-full min-h-[160px]" x-model="importText" placeholder='{"saas":[...],"plans":[...],...}'></textarea>
              <div class="mt-3 flex gap-2">
                <button class="btn rounded-xl px-3 py-2 text-sm" @click="importJSON()">
                  <i class="fa-solid fa-file-import text-sky-300 mr-2"></i>Importar
                </button>
                <button class="btn rounded-xl px-3 py-2 text-sm" @click="seedDemo()">
                  <i class="fa-solid fa-wand-magic-sparkles text-sky-300 mr-2"></i>Cargar demo
                </button>
              </div>
            </div>

            <div class="text-xs text-slate-400">
              Nota: Importar reemplaza todo el contenido actual.
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  
</body>
</html>
